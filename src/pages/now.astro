---
import { getCollection, render } from "astro:content";
import BaseLayout from "../layouts/BaseLayout.astro";
import CenteredLayout from "../layouts/CenteredLayout.astro";
import PageHeader from "../components/PageHeader.astro";
import { displayDate } from "../lib/longDate";
import type { CollectionEntry } from "astro:content";

const posts = await getCollection("now");

posts.sort(
  (a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime(),
);

const timelinePosts = await Promise.all(
  posts.map(async (post: CollectionEntry<"now">) => {
    const { Content } = await render(post);

    return {
      date: post.data.date,
      ContentComponent: Content,
    };
  }),
);
---

<BaseLayout
  title="Now"
  description="A snapshot of what I'm currently focused on â€” projects, routines, and ongoing interests."
>
  <CenteredLayout>
    <PageHeader title="Now" description="What I'm up to right now" />
    <div class="timeline">
      {
        timelinePosts.map((post) => (
          <div class="timeline-post">
            <div class="timeline-marker" />
            <div class="post-content">
              <p id="date">{displayDate(post.date)}</p>
              <div class="content">
                <post.ContentComponent />
              </div>
            </div>
          </div>
        ))
      }
    </div>
  </CenteredLayout>

  <style>
    .timeline {
      position: relative;
    }

    .timeline::before {
      content: "";
      position: absolute;
      top: 0;
      bottom: 0;
      left: 5px;
      width: 2px;
      background-color: var(--tomato-9);
    }

    .timeline-post {
      position: relative;
      margin-bottom: var(--space-xl);
    }

    .timeline-post:last-child {
      margin-bottom: 0;
    }

    .timeline-marker::before {
      content: "";
      position: absolute;
      top: 5px;
      width: 12px;
      height: 12px;
      background-color: var(--tomato-9);
    }

    .post-content {
      padding-left: var(--space-l);
    }

    .content {
      margin: var(--space-3xs) 0;
    }

    .content :global(p) {
      margin-bottom: var(--space-xs);
    }

    .content :global(p:last-child) {
      margin-bottom: 0;
    }

    #date {
      color: var(--gray-12);
      font-weight: 500;
    }
  </style>
</BaseLayout>

---
import { displayDate } from "../lib/longDate";
import type { CollectionEntry } from "astro:content";

interface Props {
  post: CollectionEntry<"posts">;
}

const { post } = Astro.props;

interface Feature {
  name: string;
  url: string;
}
---

<article>
  <div class="post-item-container">
    <a href={`/posts/${post.id}`} class="post-link-overlay" aria-label={post.data.title}></a>
    <div class="content">
      <div class="text">
        <p class="title">{post.data.title}</p>
        {
          post.data.description && (
            <p class="description">{post.data.description}</p>
          )
        }
      </div>
      <p class="date">
        <time datetime={post.data.datePublished.toISOString()}>
          {displayDate(post.data.datePublished)}
        </time>
      </p>
    </div>
    {
      post.data.features && (
        <div class="feature-text">
          <span>Featured on </span>
          {post.data.features.map(({ name, url }: Feature, i: number) => [
            i > 0 && ", ",
            <a href={url} target="_blank" rel="noopener noreferrer" class="feature-link">
              {name}
            </a>,
          ])}
        </div>
      )
    }
  </div>
</article>

<style>
  article {
    padding: var(--space-m) 0;
    border-bottom: 1px dashed var(--gray-6);
  }

  article:first-child {
    padding-top: 0;
  }

  article:last-child {
    border-bottom: none;
  }

  .post-item-container {
    position: relative;
    padding: var(--space-s);
    margin: calc(var(--space-s) * -1);
    border-radius: 9px;
    transition: background-color var(--duration-fast, 150ms) ease;
  }

  @media (hover: hover) and (pointer: fine) {
    .post-item-container:hover {
      background-color: var(--gray-3);
    }

    :global(html.dark) .post-item-container:hover {
      background-color: var(--gray-2);
    }

    .post-item-container:hover .title {
      color: var(--tomato-9);
    }
  }

  .post-link-overlay {
    position: absolute;
    inset: 0;
    z-index: 1;
    border-radius: 12px;
  }

  .content {
    display: flex;
    flex-direction: column;
    gap: var(--space-3xs);
    position: relative;
    z-index: 2;
    pointer-events: none;
  }

  @media (min-width: 640px) {
    .content {
      flex-direction: row;
      justify-content: space-between;
      align-items: flex-start;
      gap: var(--space-m);
    }
  }

  .text {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: var(--space-3xs);
  }

  .title {
    font-family: "Inter", sans-serif;
    font-size: var(--fs-2);
    font-weight: 500;
    color: var(--gray-12);
    line-height: 1.4;
    margin: 0;
    transition: color var(--duration-fast, 150ms) ease;
  }

  .description {
    line-height: 1.6;
    margin: 0;
  }

  .date {
    flex-shrink: 0;
    white-space: nowrap;
    font-variant-numeric: tabular-nums;
    margin: 0;
    order: -1;
    font-size: var(--fs--1);
  }

  @media (min-width: 640px) {
    .date {
      text-align: right;
      order: 0;
      font-size: var(--fs-0);
    }
  }

  .feature-text {
    font-size: var(--fs--1);
    margin-top: var(--space-2xs);
    position: relative;
    z-index: 2;
    pointer-events: none;
  }

  .feature-link {
    text-decoration: none;
    border-bottom: 1px solid var(--gray-6);
    transition:
      color var(--duration-fast, 150ms) ease,
      border-color var(--duration-fast, 150ms) ease;
    pointer-events: auto;
  }

  .feature-link:hover {
    color: var(--gray-12);
    border-bottom-color: var(--tomato-9);
  }
</style>
